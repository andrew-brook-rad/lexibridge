# LexiBridge Bible JSON Format

This document describes the JSON format used for storing interlinear Bible translations in LexiBridge.

## Overview

Each JSON file represents a **BookProject** containing metadata, print settings, and one or more chapters with tokenized, glossed text.

## File Structure

```json
{
  "meta": { ... },
  "printSettings": { ... },
  "chapters": [ ... ]
}
```

---

## 1. Meta

Project metadata.

```json
"meta": {
  "title": "Genesis 1 (Afrikaans)",
  "language": "AF"
}
```

| Field | Type | Description |
|-------|------|-------------|
| `title` | string | Display title for the project |
| `language` | string | Source language code (e.g., "DE", "AF", "HE") |

---

## 2. Print Settings

Typography and layout configuration. These can be omitted to use defaults.

```json
"printSettings": {
  "pageSize": "6x9",
  "margins": {
    "top": 0.75,
    "bottom": 0.75,
    "inner": 0.875,
    "outer": 0.5
  },
  "baseFontSize": 12,
  "typography": {
    "mainFont": "Georgia, serif",
    "mainFontSize": 10,
    "glossFont": "Inter, sans-serif",
    "glossFontSize": 5,
    "verseNumSize": 5,
    "verseNumColor": "#000000",
    "verseNumOffset": -1,
    "verseNumOffsetX": 2,
    "lineHeight": 1.8
  }
}
```

### Page Sizes (KDP Trim Sizes)
- `"5x8"` - Mass Market
- `"5.5x8.5"` - Digest
- `"6x9"` - US Trade (recommended)
- `"6.14x9.21"` - Royal
- `"7x10"` - Executive
- `"8.5x11"` - Letter
- `"A5"` - International
- `"custom"` - Use `customWidth` and `customHeight`

### Margins (inches)
- `inner` - Gutter margin (binding side)
- `outer` - Outside edge
- `top` / `bottom` - Vertical margins

---

## 3. Chapters

Array of chapter objects. Each chapter contains numbered paragraphs.

```json
"chapters": [
  {
    "number": 1,
    "paragraphs": [
      [ /* tokens */ ],
      [ /* tokens */ ]
    ]
  },
  {
    "number": 2,
    "paragraphs": [ ... ]
  }
]
```

| Field | Type | Description |
|-------|------|-------------|
| `number` | integer | Chapter number (1-indexed) |
| `paragraphs` | array | Array of paragraphs, each containing tokens |

---

## 4. Token Types

Paragraphs are arrays of tokens. There are four token types:

### 4.1 Word Token

The primary token type for interlinear text. Each word can have multiple morpheme parts.

```json
{
  "type": "word",
  "original_full": "geskape",
  "parts": [
    {
      "text": "geskape",
      "gloss": "CREATED"
    }
  ]
}
```

**With multiple morphemes** (for compound words or morphological analysis):

```json
{
  "type": "word",
  "original_full": "wêreldvloed",
  "parts": [
    { "text": "wêreld", "gloss": "WORLD" },
    { "text": "vloed", "gloss": "FLOOD" }
  ]
}
```

| Field | Type | Description |
|-------|------|-------------|
| `type` | `"word"` | Token type identifier |
| `original_full` | string | The complete original word |
| `parts` | array | Array of morpheme parts |
| `parts[].text` | string | Source language text |
| `parts[].gloss` | string | English gloss (translation) |

**Gloss Conventions:**
- Use UPPERCASE for glosses (rendered as lowercase in output)
- Keep glosses concise (1-3 words)
- Use hyphens for multi-word glosses: `"TO-BE"`

### 4.2 Verse Number Token

Marks verse boundaries. Rendered as superscript numbers.

```json
{
  "type": "verse_num",
  "value": "1"
}
```

| Field | Type | Description |
|-------|------|-------------|
| `type` | `"verse_num"` | Token type identifier |
| `value` | string | Verse number as string |

### 4.3 Punctuation Token

Standalone punctuation marks.

```json
{
  "type": "punctuation",
  "value": "."
}
```

| Field | Type | Description |
|-------|------|-------------|
| `type` | `"punctuation"` | Token type identifier |
| `value` | string | Punctuation character(s) |

**Supported punctuation:** `. , ; : ! ? " ' ( ) — -`

### 4.4 Chapter Number Token

Decorative chapter numerals (auto-generated by the layout engine, not typically in source JSON).

```json
{
  "type": "chapter_num",
  "value": 1
}
```

---

## 5. Complete Example

Genesis 1:1-3 in Afrikaans with English glosses:

```json
{
  "meta": {
    "title": "Genesis",
    "language": "AF"
  },
  "printSettings": {
    "pageSize": "6x9",
    "margins": {
      "top": 0.75,
      "bottom": 0.75,
      "inner": 0.875,
      "outer": 0.5
    },
    "typography": {
      "mainFont": "Georgia, serif",
      "mainFontSize": 10,
      "glossFont": "Inter, sans-serif",
      "glossFontSize": 5,
      "verseNumSize": 5,
      "verseNumColor": "#000000",
      "verseNumOffset": -1,
      "verseNumOffsetX": 2,
      "lineHeight": 1.8
    }
  },
  "chapters": [
    {
      "number": 1,
      "paragraphs": [
        [
          {"type": "verse_num", "value": "1"},
          {"type": "word", "original_full": "In", "parts": [{"text": "In", "gloss": "IN"}]},
          {"type": "word", "original_full": "die", "parts": [{"text": "die", "gloss": "THE"}]},
          {"type": "word", "original_full": "begin", "parts": [{"text": "begin", "gloss": "BEGINNING"}]},
          {"type": "word", "original_full": "het", "parts": [{"text": "het", "gloss": "HAS"}]},
          {"type": "word", "original_full": "God", "parts": [{"text": "God", "gloss": "GOD"}]},
          {"type": "word", "original_full": "die", "parts": [{"text": "die", "gloss": "THE"}]},
          {"type": "word", "original_full": "hemel", "parts": [{"text": "hemel", "gloss": "HEAVEN"}]},
          {"type": "word", "original_full": "en", "parts": [{"text": "en", "gloss": "AND"}]},
          {"type": "word", "original_full": "die", "parts": [{"text": "die", "gloss": "THE"}]},
          {"type": "word", "original_full": "aarde", "parts": [{"text": "aarde", "gloss": "EARTH"}]},
          {"type": "word", "original_full": "geskape", "parts": [{"text": "geskape", "gloss": "CREATED"}]},
          {"type": "punctuation", "value": "."},

          {"type": "verse_num", "value": "2"},
          {"type": "word", "original_full": "En", "parts": [{"text": "En", "gloss": "AND"}]},
          {"type": "word", "original_full": "die", "parts": [{"text": "die", "gloss": "THE"}]},
          {"type": "word", "original_full": "aarde", "parts": [{"text": "aarde", "gloss": "EARTH"}]},
          {"type": "word", "original_full": "was", "parts": [{"text": "was", "gloss": "WAS"}]},
          {"type": "word", "original_full": "woes", "parts": [{"text": "woes", "gloss": "FORMLESS"}]},
          {"type": "word", "original_full": "en", "parts": [{"text": "en", "gloss": "AND"}]},
          {"type": "word", "original_full": "leeg", "parts": [{"text": "leeg", "gloss": "EMPTY"}]},
          {"type": "punctuation", "value": "."},

          {"type": "verse_num", "value": "3"},
          {"type": "word", "original_full": "En", "parts": [{"text": "En", "gloss": "AND"}]},
          {"type": "word", "original_full": "God", "parts": [{"text": "God", "gloss": "GOD"}]},
          {"type": "word", "original_full": "het", "parts": [{"text": "het", "gloss": "HAS"}]},
          {"type": "word", "original_full": "gesê", "parts": [{"text": "gesê", "gloss": "SAID"}]},
          {"type": "punctuation", "value": ":"},
          {"type": "word", "original_full": "Laat", "parts": [{"text": "Laat", "gloss": "LET"}]},
          {"type": "word", "original_full": "daar", "parts": [{"text": "daar", "gloss": "THERE"}]},
          {"type": "word", "original_full": "lig", "parts": [{"text": "lig", "gloss": "LIGHT"}]},
          {"type": "word", "original_full": "wees", "parts": [{"text": "wees", "gloss": "BE"}]},
          {"type": "punctuation", "value": "!"}
        ]
      ]
    }
  ]
}
```

---

## 6. Token Ordering Rules

1. **Verse numbers** come BEFORE the first word of that verse
2. **Punctuation** comes AFTER the word it follows (no space between word and punctuation)
3. **Words** maintain source language word order
4. All tokens in a paragraph flow continuously (no line breaks in JSON)

---

## 7. File Organization for Full Bible

Suggested structure for organizing the complete Bible:

```
data/
├── old-testament/
│   ├── genesis/
│   │   ├── genesis-1.json      # Chapter 1
│   │   ├── genesis-2.json      # Chapter 2
│   │   └── ...
│   ├── exodus/
│   └── ...
├── new-testament/
│   ├── matthew/
│   ├── mark/
│   └── ...
└── complete/
    ├── genesis-complete.json   # All chapters combined
    └── ...
```

Or for a single-file approach:

```json
{
  "meta": { "title": "Genesis", "language": "AF" },
  "chapters": [
    { "number": 1, "paragraphs": [...] },
    { "number": 2, "paragraphs": [...] },
    // ... all 50 chapters
  ]
}
```

---

## 8. Translation Workflow

1. **Source Text**: Start with source language Bible text
2. **Tokenization**: Split into words and punctuation
3. **Glossing**: Add English glosses for each word/morpheme
4. **Review**: Check glosses for accuracy
5. **Export**: Save as JSON in this format
6. **Import**: Load into LexiBridge for typesetting

The `/api/translate` endpoint can automate steps 2-3 using AI, but manual review is recommended.

---

## TypeScript Types

For reference, these types are defined in `/types/index.ts`:

```typescript
interface WordPart {
  text: string
  gloss: string
  width?: number  // Added by layout engine
}

interface VerseNumToken {
  type: 'verse_num'
  value: string
}

interface WordToken {
  type: 'word'
  original_full: string
  parts: WordPart[]
}

interface PunctuationToken {
  type: 'punctuation'
  value: string
}

type Token = VerseNumToken | WordToken | PunctuationToken

interface Chapter {
  number: number
  paragraphs: Token[][]
}

interface BookProject {
  meta: { title: string; language: string }
  printSettings: PrintSettings
  chapters: Chapter[]
}
```
